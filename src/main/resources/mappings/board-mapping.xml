<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="board">

	<insert id="writeFreeBoard">
		INSERT INTO board (id, nickname, title, bcontent, bdatetime, views, likes, bno, commentCount)
		VALUES(#{id}, #{nickname}, #{title}, #{bcontent}, sysdate(), 0, 0, 1, 0)	
	</insert>
	
	
	
	<update id="updateBoard">
		UPDATE board 
		SET title = #{title}, bcontent = #{bcontent}
		WHERE pno = #{pno}
	</update>
	
	<delete id="deleteBoard">
		DELETE FROM board
		WHERE pno = #{pno}
	</delete>
	
	
	<select id="getBoard" parameterType = "board" resultType="board">
		SELECT * 
		FROM board
		WHERE pno = #{pno}
	</select>
	
	<select id="getBoardList" resultType="board">
		SELECT * FROM board
		ORDER BY pno DESC
	</select>
	
	<!-- 기존것 -->
	<select id="getMyBoard2" parameterType="user" resultType="board">
		SELECT * FROM board
		WHERE id=#{id}
		ORDER BY pno DESC
	</select>
	
	<!-- pagination용 -->
	<select id="myBoardCount" parameterType="user" resultType="int">
		select count(*)
		from board
		where id=#{id}
	</select>
	
	
	<select id="myCommentCount" parameterType="user" resultType="int">
		select count(*)
		from commentlist
		where id=#{id}
	</select>
	
	<select id="getMyBoard" parameterType="page" resultType="board">
		select *
		from board
		where id=#{util.id}
		<if test='util.bSearchStyle.equals("제목")'>
		and title like CONCAT('%', #{util.boardKeyword}, '%')
		</if>
		<if test='util.bSearchStyle.equals("내용")'>
		and bcontent like CONCAT('%', #{util.boardKeyword}, '%')
		</if>
		limit #{start}, #{cntPerPage}
	</select>
	
	<select id="getMyComment" parameterType="page" resultType="comment">
		select *
		from commentList
		where id=#{util.id}
		<if test='!util.commentKeyword.equals("")'>
		and ccontent like CONCAT('%', #{util.commentKeyword}, '%')
		</if>
		limit #{start}, #{cntPerPage}
	</select>
	
	
	<!-- 자유게시판 페이징처리 -->
	<select id="boardCount" parameterType="board" resultType="int">
		select count(*)
		from board
		where bno = 1
	</select>
		
	<select id="boardList" parameterType="page" resultType="board">
		select *
		from board
		where bno=1
		order by pno desc
		limit #{start}, #{cntPerPage}
	</select>
	
	<update id="commentCount">
		UPDATE board set
		commentCount = #{commentCount}
		WHERE pno = #{pno};	
	</update>
	
</mapper>